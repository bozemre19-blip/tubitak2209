{% extends "base.html" %}

{% block title %}{{ announcement.title }} - Okunma Durumu{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Anasayfa</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('admin_classes') }}">Sınıflar</a></li>
                <li class="breadcrumb-item">
                    <a href="{{ url_for('admin_class_detail', class_id=announcement.class_id) }}">
                        {{ announcement.class_ref.name }}
                    </a>
                </li>
                <li class="breadcrumb-item active">{{ announcement.title }}</li>
            </ol>
        </nav>
        
        <h1><i class="bi bi-megaphone"></i> {{ announcement.title }}</h1>
        <p class="lead">{{ announcement.content }}</p>
    </div>
</div>

<!-- İstatistikler -->
<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="card bg-success text-white">
            <div class="card-body text-center">
                <i class="bi bi-check-circle-fill" style="font-size: 2rem;"></i>
                <h3 class="mt-2">{{ readers|length }}</h3>
                <p class="mb-0">Okuyan Öğrenci</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-3">
        <div class="card bg-warning text-dark">
            <div class="card-body text-center">
                <i class="bi bi-hourglass-split" style="font-size: 2rem;"></i>
                <h3 class="mt-2">{{ not_read_students|length }}</h3>
                <p class="mb-0">Okumayan Öğrenci</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-3">
        <div class="card bg-info text-white">
            <div class="card-body text-center">
                <i class="bi bi-percent" style="font-size: 2rem;"></i>
                <h3 class="mt-2">{{ ((readers|length / total_students * 100)|round(1) if total_students > 0 else 0) }}%</h3>
                <p class="mb-0">Okunma Oranı</p>
            </div>
        </div>
    </div>
</div>

<!-- Okuyan Öğrenciler -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-success">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="bi bi-check-circle-fill"></i> Okuyan Öğrenciler ({{ readers|length }})
                </h5>
            </div>
            <div class="card-body">
                {% if readers %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Öğrenci</th>
                                <th>E-posta</th>
                                <th>Okunma Tarihi</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for read in readers|sort(attribute='read_at', reverse=true) %}
                            <tr>
                                <td>
                                    <i class="bi bi-person-circle text-success"></i> 
                                    <strong>{{ read.student.full_name }}</strong>
                                </td>
                                <td>{{ read.student.email }}</td>
                                <td>
                                    <i class="bi bi-clock"></i> {{ read.read_at|datetime }}
                                    <span class="badge bg-success ms-2">
                                        <i class="bi bi-check2"></i> Okundu
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="bi bi-check-circle"></i>
                    <p>Henüz hiçbir öğrenci okumadı.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Okumayan Öğrenciler -->
{% if not_read_students %}
<div class="row">
    <div class="col-12">
        <div class="card border-warning">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i class="bi bi-exclamation-triangle-fill"></i> Okumayan Öğrenciler ({{ not_read_students|length }})
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Öğrenci</th>
                                <th>E-posta</th>
                                <th>Durum</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for student in not_read_students %}
                            <tr>
                                <td>
                                    <i class="bi bi-person-circle text-warning"></i> 
                                    {{ student.full_name }}
                                </td>
                                <td>{{ student.email }}</td>
                                <td>
                                    <span class="badge bg-warning text-dark">
                                        <i class="bi bi-hourglass-split"></i> Okunmadı
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

